version: '3.5'

services:
  api:
    build:
      context: .
      dockerfile: ./Dockerfile
    depends_on:
      - postgres
    environment:
      RDS_DATABASE_URI: postgresql+psycopg2://rdschannel:rdschannel@postgres/rdschannel
    ports: ['5000:5000']
    command: bash -c "cd /src && python manage.py runserver -h 0.0.0.0"

  postgres:
    image: postgres:10.5
    environment:
      - POSTGRES_USER=rdschannel
      - POSTGRES_PASSWORD=rdschannel
      - POSTGRES_DB=rdschannel
    ports: ['5432:5432']
    restart: on-failure
